// Generated by CoffeeScript 1.3.3

/*
  Shortcode.js 0.9
  Replace Wordpress-style shortcodes with HTML on the fly
  by Nic Aitch @nicinabox
*/


(function() {

  $.fn.shortcode = function(services) {
    var run;
    services = $.extend({}, $.fn.shortcode.services, services);
    run = function(code, options, el) {
      return services[code](options, el);
    };
    return this.each(function() {
      var html, replacement,
        _this = this;
      html = $(this).html();
      replacement = '';
      return $.each(services, function(shortcode) {
        var crude_options, match, options, regex;
        regex = new RegExp("\\[" + shortcode + "(.*?)?\\]", "g");
        options = {};
        match = regex.exec(html);
        if (match && match[1]) {
          crude_options = $.trim(match[1]).split(' ');
          $.each(crude_options, function(i) {
            var opts;
            opts = crude_options[i].split("=");
            return options[opts[0]] = opts[1].replace(/"/g, '');
          });
        }
        replacement = run(shortcode, options, _this);
        html = $(_this).html();
        if (replacement.jquery) {
          replacement = replacement[0].outerHTML;
        }
        if (replacement) {
          html = html.replace(regex, replacement);
          return $(_this).html(html);
        }
      });
    });
  };

}).call(this);
