// Generated by CoffeeScript 1.7.1

/*
  shortcode.js 0.9.1
  Replace Wordpress-style shortcodes with HTML on the fly
  by Nic Aitch @nicinabox
  MIT License
 */

(function() {
  $.fn.shortcode = function(services) {
    var run;
    services = $.extend({}, $.fn.shortcode.services, services);
    run = function(code, options, content, el) {
      return services[code](el, options, content);
    };
    return this.each(function() {
      var html, replacement, _this;
      _this = this;
      html = $(this).html();
      replacement = '';
      return $.each(services, (function(_this) {
        return function(shortcode) {
          var content, crude_options, match, options, regex, regexs;
          regexs = ["\\[" + shortcode + "(.*?)?\\](.*?)?\\[\\/" + shortcode + "\\]", "\\[" + shortcode + "(.*?)?\\]"];
          options = {};
          crude_options = '';
          content = '';
          match = [];
          regex = '';
          return $.each(regexs, function(i) {
            regex = new RegExp(regexs[i], "g");
            match = regex.exec(html);
            while (match) {
              if (match[1]) {
                crude_options = $.trim(match[1]).split(' ');
              }
              if (match[2]) {
                content = $.trim(match[2]);
              }
              $.each(crude_options, function(i) {
                var opts;
                opts = crude_options[i].split("=");
                options[opts[0]] = opts[1].replace(/"/g, '');
                replacement = run(shortcode, options, content, _this);
                html = $(_this).html();
                if (replacement) {
                  if (replacement.jquery) {
                    replacement = replacement[0].outerHTML;
                  }
                  html = html.replace(regex, replacement);
                  return $(_this).html(html);
                }
              });
              match = regex.exec(html);
            }
            return true;
          });
        };
      })(this));
    });
  };

}).call(this);
